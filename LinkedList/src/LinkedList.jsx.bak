// src/LinkedList.js
import React, { useState, useRef } from 'react';
import Node from './Node';
import './LinkedList.css';

// üí° –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –∫–ª–∞—Å—Å –¥–ª—è –ª–æ–≥–∏–∫–∏ —É–∑–ª–∞ (–Ω–µ React-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç)
class ListNode {
  constructor(value) {
    this.value = value;
    this.next = null;
  }
}

const LinkedList = () => {
  // –°–æ—Å—Ç–æ—è–Ω–∏–µ: —Ö—Ä–∞–Ω–∏—Ç –≥–æ–ª–æ–≤—É —Å–ø–∏—Å–∫–∞ (–ø–µ—Ä–≤—ã–π —É–∑–µ–ª)
  const [head, setHead] = useState(null);
  const inputRef = useRef(null); // –°—Å—ã–ª–∫–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –ø–æ–ª—è –≤–≤–æ–¥–∞

  /**
   * ‚ûï –õ–æ–≥–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —É–∑–ª–∞ –≤ –∫–æ–Ω–µ—Ü —Å–ø–∏—Å–∫–∞.
   */
  const addNode = () => {
    // –ü–æ–ª—É—á–∞–µ–º –∏ –æ—á–∏—â–∞–µ–º –≤–≤–µ–¥–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    const value = inputRef.current.value.trim();
    if (value === '') return; // –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—É—Å—Ç–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    inputRef.current.value = '';

    const newNode = new ListNode(value);

    // 1. –ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç, –Ω–æ–≤—ã–π —É–∑–µ–ª —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≥–æ–ª–æ–≤–æ–π.
    if (!head) {
      setHead(newNode);
      return;
    }

    // 2. –ò–Ω–∞—á–µ, –∏—â–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —É–∑–µ–ª (—Ö–≤–æ—Å—Ç).
    let current = head;
    while (current.next) {
      current = current.next;
    }

    // 3. –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —É–∑–µ–ª –≤ –∫–æ–Ω–µ—Ü.
    current.next = newNode;

    // ‚ùó –í–∞–∂–Ω–æ: –î–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è React-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
    // —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∫–æ–ø–∏—é –≥–æ–ª–æ–≤—ã —Å–ø–∏—Å–∫–∞ (–∏–ª–∏ –ª—é–±–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –≤ —Ü–µ–ø–æ—á–∫–µ).
    // –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ React —É–≤–∏–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è.
    setHead({ ...head });
  };

  /**
   * üñºÔ∏è –õ–æ–≥–∏–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ (–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏) —Å–ø–∏—Å–∫–∞.
   */
  const renderList = () => {
    const nodes = [];
    let current = head;

    while (current) {
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—É—â–∏–π —É–∑–µ–ª —Ö–≤–æ—Å—Ç–æ–º (–ø–æ—Å–ª–µ–¥–Ω–∏–º)
      const isTail = current.next === null;

      // –î–æ–±–∞–≤–ª—è–µ–º React-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç —É–∑–ª–∞
      nodes.push(
        <Node
          key={nodes.length} // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á –¥–ª—è React-—ç–ª–µ–º–µ–Ω—Ç–æ–≤
          value={current.value}
          isTail={isTail}
        />
      );
      current = current.next;
    }
    return nodes;
  };

  return (
    <div className="linked-list-app">
      <h2>–õ–∏–Ω–µ–π–Ω—ã–π –°–≤—è–∑–Ω—ã–π –°–ø–∏—Å–æ–∫</h2>

      {/* ‚û°Ô∏è –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */}
      <div className="controls">
        <input
          type="text"
          ref={inputRef}
          placeholder="–ó–Ω–∞—á–µ–Ω–∏–µ —É–∑–ª–∞"
        />
        <button onClick={addNode}>
          ‚ûï –î–æ–±–∞–≤–∏—Ç—å —É–∑–µ–ª –≤ –∫–æ–Ω–µ—Ü
        </button>
      </div>

      <hr />

      {/* üñºÔ∏è –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ */}
      <div className="list-visualization">
        {head ? (
          renderList()
        ) : (
          <p className="empty-list">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —É–∑–µ–ª.</p>
        )}
      </div>
    </div>
  );
};

export default LinkedList;